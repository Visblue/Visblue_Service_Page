<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fejloversigt</title>
    <style>
        /* Body-stil */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #2c3e50;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: white;
            height: 100vh;
            justify-content: center;
            overflow: hidden;
        }

        /* Header-stil */
        .header {
            width: 80%;
            max-width: 1200px;
            background: #4CAF50;
            color: white;
            padding: 20px;
            text-align: center;
            font-size: 22px;
            margin-top: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            display: none; /* Skjul header ved indlæsning */
        }

        /* Tabel-stil */
        table {
        	position:sticky;
            width: 80%;
            max-width: 1200px;
            border-collapse: collapse;
            margin: 20px auto;
            background-color: white;
            border-radius: 8px;
            overflow:auto;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: none; /* Skjul tabel ved indlæsning */
        }

        th, td {
            padding: 12px;
            text-align: center;
            color: #333;
            overflow:auto;
        }

        th {
            background-color: #4CAF50;
            color: white;
            cursor: pointer;
            overflow:auto;
        }

        td {
            background-color: #f2f2f2;
            border-bottom: 1px solid #ddd;
            overflow:auto;
        }

        tr:hover td {
            background-color: #e0e0e0;
           overflow:auto;
        }
       body {
            font-family: 'Arial', sans-serif;
            background-color: #2c3e50;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: white;
            height: 100vh;
            justify-content: center;
            overflow: hidden;
        }

        /* Flex-container for tabel og filtrering */
        .container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            overflow:auto;
        }

/* Tilføj stil for flex-container */
.filter-container {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 20px; /* Juster mellemrum mellem sektionerne */
}


/* Stil for den samlede filterboks */
.filter-box {
    background-color: #34495e;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    color: white;
    display: inline-block; /* Gør boksen mindre end skærmbredden */
    margin-top: 20px;
}

/* Tilføj stil for flex-container */
.filter-container {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 20px; /* Juster mellemrum mellem sektionerne */
}

/* Stil for den samlede filterboks */
.filter-box {
    background-color: #1c2833; /* Mørkere baggrund for en professionel stil */
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.25); /* Blødere og mere fremtrædende skygge */
    color: white;
    display: inline-block;
    margin-top: 20px;
    max-width: 600px; /* For at sikre at det ikke bliver for bredt */
    transition: box-shadow 0.3s ease; /* Smooth hover-effekt */
}

.filter-box:hover {
    box-shadow: 0 12px 24px rgba(0, 0, 0, 0.35); /* Hover-effekt for en mere dynamisk følelse */
}

/* Tilføj stil for flex-container */
.filter-container {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 30px; /* Øget mellemrum for en mere åben layout */
}

/* Stil for knappen */
.filter-button {
    text-align: center;
    margin-top: 20px;
}

.filter-button button {
    background-color: #4CAF50;
    color: white;
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
}

.filter-button button:hover {
    background-color: #45a049;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

/* Juster filter-sektionerne så de ser ens ud */
.filter-section {
    background-color: #2c3e50; /* Lysere baggrund for kontrast */
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); /* Let skygge for 3D-effekt */
    flex: 1;
}

/* Stil for labels og checkboxes */
.filter-section label {
    display: flex;
    align-items: center;
   

        .highlight {
            background-color: #ffeb3b !important;
        }

        /* Ballonstil */
        .balloon {
            width: 50px;
            height: 70px;
            background-color: #4CAF50;
            border-radius: 50% 50% 45% 45%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.5s ease;
        }

        /* Fragment-stil */
        .fragment {
            position: absolute;
            width: 8px;
            height: 8px;
            background-color: #4CAF50;
            border-radius: 50%;
            opacity: 0.7;
            pointer-events: none;
            transition: all 0.5s ease;
        }
    </style>
</head>

<body>

    <div class="balloon"></div> <!-- Ballon -->
    <div class="header" id="header">
        <p style="color:white;">Antal fejl: <span id="errorCount">0</span> | Seneste fejl: <span id="latestError">Ingen fejl</span></p>
    </div>

    <!-- Container for tabel og filtreringssektion -->
    <div class="container">
        <table id="errorTable">
            <thead>
                <tr>
                    <th onclick="sortTable(0)" style="text-align: center;">&nbsp; ProjektNr</th>
                    <th onclick="sortTable(1)" style="text-align: left;">Site</th>
                    <th onclick="sortTable(2)">Error</th>
                    <th onclick="sortTable(3)">Time &#x25B2;&#x25BC;</th>
                </tr>
            </thead>
            <tbody>
                {% for site in siteErrorData %}
                <tr>
                    <td style="text-align: center;">[{{site['Prioritet']}}] &nbsp; &nbsp; &nbsp; {{ site['ProjectNr'] | int }}</td>
                    <td style="text-align: left;">{{ site['Kunde'] }}</td>
                    <td>{{ site['Battery_status'] }}</td>
                    <td>{{ site['Time'] }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

    <!-- En samlet container for filtrering -->
<!-- En samlet container for filtrering -->
<div class="filter-box">
    <div class="filter-container">
        <div class="filter-section">
            <h3>Filtrer efter prioritet</h3>
            <label>
                <input type="checkbox" class="priority-checkbox" value="1" checked> Prioritet 1
            </label><br>
            <label>
                <input type="checkbox" class="priority-checkbox" value="2" checked> Prioritet 2
            </label><br>
            <label>
                <input type="checkbox" class="priority-checkbox" value="3" checked> Prioritet 3
            </label><br>
            <label>
                <input type="checkbox" class="priority-checkbox" value="4" checked> Prioritet 4
            </label><br>
        </div>

        <div class="filter-section">
            <h3>Filtrer efter type</h3>
            <label>
                <input type="checkbox" class="type-checkbox" value="grid" checked> Grid
            </label><br>
            <label>
                <input type="checkbox" class="type-checkbox" value="pv" checked> PV
            </label><br>
            <label>
                <input type="checkbox" class="type-checkbox" value="bat" checked> Battery
            </label><br>
        </div>
    </div>

    <!-- Knappen til at opdatere filtreringen -->
    <div class="filter-button">
        <button onclick="filterByPriorityAndType()">Opdater filtrering</button>
    </div>
</div>

</body>
    <script>
    setInterval(function() {
    location.reload();
}, 300000); // 300000 millisekunder svarer til 5 minutter
 // 60
 
/*
function filterByPriorityAndType() {
    let priorityCheckboxes = document.querySelectorAll(".priority-checkbox");
    let selectedPriorities = Array.from(priorityCheckboxes)
        .filter(checkbox => checkbox.checked)
        .map(checkbox => parseInt(checkbox.value, 10));

    let typeCheckboxes = document.querySelectorAll(".type-checkbox");
    let selectedTypes = Array.from(typeCheckboxes)
        .filter(checkbox => checkbox.checked)
        .map(checkbox => checkbox.value);

    let table = document.getElementById("errorTable");
    let rows = table.getElementsByTagName("tr");

    for (let i = 1; i < rows.length; i++) {
        let priorityCell = rows[i].getElementsByTagName("TD")[0];
        let errorCell = rows[i].getElementsByTagName("TD")[1];
        if (priorityCell && errorCell) {
            let rowPriority = priorityCell.innerHTML.match(/\[(\d+)\]/);
            let rowError = errorCell.innerHTML;
            

            if (rowPriority) {
                rowPriority = parseInt(rowPriority[1], 10);

                // Bestem typen baseret på om navnet indeholder _grid, _pv eller ingenting (battery)
                let rowType = '';
                if (rowError.toLowerCase().includes("grid")) {
                    rowType = 'grid';
                } else if (rowError.toLowerCase().includes("pv")) {
                    rowType = 'pv';
                } else {
                    rowType = 'bat'; // Alt andet antages som battery
                }

                // Tjek om både prioritet og type matcher filtreringen
                if (selectedPriorities.includes(rowPriority) && selectedTypes.includes(rowType)) {
                    rows[i].style.display = ""; // Vis række, hvis både prioritet og type matcher
                } else {
                    rows[i].style.display = "none"; // Skjul række, hvis ikke begge matcher
                }
            }
        }
    }

    updateHeader(); // Opdater headeren efter filtrering
}*/
function filterByPriorityAndType() {
    let priorityCheckboxes = document.querySelectorAll(".priority-checkbox");
    let selectedPriorities = Array.from(priorityCheckboxes)
        .filter(checkbox => checkbox.checked)
        .map(checkbox => parseInt(checkbox.value, 10));

    let typeCheckboxes = document.querySelectorAll(".type-checkbox");
    let selectedTypes = Array.from(typeCheckboxes)
        .filter(checkbox => checkbox.checked)
        .map(checkbox => checkbox.value);

    let table = document.getElementById("errorTable");
    let rows = table.getElementsByTagName("tr");
    let visibleErrorCount = 0; // Tæl antallet af synlige rækker

    for (let i = 1; i < rows.length; i++) {
        let priorityCell = rows[i].getElementsByTagName("TD")[0];
        let errorCell = rows[i].getElementsByTagName("TD")[1];
        if (priorityCell && errorCell) {
            let rowPriority = priorityCell.innerHTML.match(/\[(\d+)\]/);
            let rowError = errorCell.innerHTML;

            if (rowPriority) {
                rowPriority = parseInt(rowPriority[1], 10);

                // Bestem typen baseret på om navnet indeholder _grid, _pv eller ingenting (battery)
                let rowType = '';
                if (rowError.toLowerCase().includes("grid")) {
                    rowType = 'grid';
                } else if (rowError.toLowerCase().includes("pv")) {
                    rowType = 'pv';
                } else {
                    rowType = 'bat'; // Alt andet antages som battery
                }

                // Tjek om både prioritet og type matcher filtreringen
                if (selectedPriorities.includes(rowPriority) && selectedTypes.includes(rowType)) {
                    rows[i].style.display = ""; // Vis række, hvis både prioritet og type matcher
                    visibleErrorCount++; // Øg tællingen for synlige fejl
                } else {
                    rows[i].style.display = "none"; // Skjul række, hvis ikke begge matcher
                }
            }
        }
    }

    updateHeader(visibleErrorCount); // Opdater headeren med det aktuelle antal synlige fejl
}

function updateHeader(visibleErrorCount) {
    let table = document.getElementById("errorTable");
    let rows = table.getElementsByTagName("tr");
    let newestRow = null;

    for (let i = 1; i < rows.length; i++) {
        if (rows[i].style.display !== "none") { // Kun kig på synlige rækker
            let timeCell = rows[i].getElementsByTagName("TD")[3];
            let currentErrorTime = parseDate(timeCell.innerHTML);

            if (!newestRow || currentErrorTime > parseDate(newestRow.getElementsByTagName("TD")[3].innerHTML)) {
                newestRow = rows[i];
            }
        }
    }

    if (newestRow) {
        let siteName = newestRow.getElementsByTagName("TD")[1].innerHTML;
        let error = newestRow.getElementsByTagName("TD")[2].innerHTML;
        document.getElementById("latestError").innerHTML = siteName + " - " + error;
    } else {
        document.getElementById("latestError").innerHTML = "Ingen fejl";
    }

    document.getElementById("errorCount").innerHTML = visibleErrorCount; // Opdater antal fejl baseret på synlige rækker
}


        function parseDate(dateString) {
            const [datePart, timePart] = dateString.split(' ');
            const [day, month, year] = datePart.split('-');
            const [hours, minutes] = timePart.split(':');
            return new Date(year, month - 1, day, hours, minutes);
        }
/*
        function updateHeader() {
            let table = document.getElementById("errorTable");
            let rows = table.getElementsByTagName("tr");
            let errorCount = rows.length - 1;
            let newestRow = null;

            for (let i = 1; i < rows.length; i++) {
                let timeCell = rows[i].getElementsByTagName("TD")[3];
                let currentErrorTime = parseDate(timeCell.innerHTML);

                if (!newestRow || currentErrorTime > parseDate(newestRow.getElementsByTagName("TD")[3].innerHTML)) {
                    newestRow = rows[i];
                }
            }

            if (newestRow) {
                let siteName	= newestRow.getElementsByTagName("TD")[1].innerHTML;
                let error		= newestRow.getElementsByTagName("TD")[2].innerHTML;
                document.getElementById("latestError").innerHTML = siteName + " - " + error;
            } else {
                document.getElementById("latestError").innerHTML = "Ingen fejl";
            }

            document.getElementById("errorCount").innerHTML = errorCount;
        }*/

        function sortTable(columnIndex) {
            let table, rows, switching, i, x, y, shouldSwitch;
            table = document.getElementById("errorTable");
            switching = true;
            let asc = true;

            while (switching) {
                switching = false;
                rows = table.rows;

                for (i = 1; i < (rows.length - 1); i++) {
                    shouldSwitch = false;
                    x = rows[i].getElementsByTagName("TD")[columnIndex];
                    y = rows[i + 1].getElementsByTagName("TD")[columnIndex];

                    if (asc) {
                        if (columnIndex === 2) {
                            if (parseDate(x.innerHTML) > parseDate(y.innerHTML)) {
                                shouldSwitch = true;
                                break;
                            }
                        } else {
                            if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                                shouldSwitch = true;
                                break;
                            }
                        }
                    } else {
                        if (columnIndex === 2) {
                            if (parseDate(x.innerHTML) < parseDate(y.innerHTML)) {
                                shouldSwitch = true;
                                break;
                            }
                        } else {
                            if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
                                shouldSwitch = true;
                                break;
                            }
                        }
                    }
                }

                if (shouldSwitch) {
                    rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                    switching = true;
                } else {
                    if (switching === false && asc) {
                        asc = false;
                        switching = true;
                    }
                }
            }

            highlightNewestRow();
            updateHeader();
        }

        function highlightNewestRow() {
            let table = document.getElementById("errorTable");
            let rows = table.getElementsByTagName("tr");
            let newestRow = rows[1];

            if (newestRow) {
                newestRow.classList.add("highlight");
                setTimeout(function () {
                    newestRow.classList.remove("highlight");
                }, 5000);
            }
        }

        function createFragments(x, y) {
            for (let i = 0; i < 30; i++) {
                const fragment = document.createElement('div');
                fragment.classList.add('fragment');
                fragment.style.left = `${x}px`;
                fragment.style.top = `${y}px`;
                document.body.appendChild(fragment);

                const angle = Math.random() * 2 * Math.PI;
                const distance = Math.random() * 100 + 50;
                const fragmentX = Math.cos(angle) * distance;
                const fragmentY = Math.sin(angle) * distance;

                fragment.style.transform = `translate(${fragmentX}px, ${fragmentY}px) scale(0.5)`;
                setTimeout(() => {
                    fragment.style.opacity = '0';
                }, 500);

                setTimeout(() => {
                    fragment.remove();
                }, 1000);
            }
        }

        window.onload = function () {
        	
            const balloon = document.querySelector('.balloon');
            balloon.style.display = "flex"; // Vis ballon

            setTimeout(() => {
                balloon.style.transform = 'translate(-50%, -50%) scale(20)'; // Gør ballonen større
                setTimeout(() => {
                    createFragments(window.innerWidth / 2, window.innerHeight / 2); // Skab fragmenter
                    balloon.style.transition = 'transform 0.5s ease'; // Gør animationen mere naturlig
                    balloon.style.transform = 'translate(-50%, -50%) scale(0)'; // Spræng ballon
                    setTimeout(() => {
                        document.getElementById("header").style.display = "block"; // Vis header
                        document.getElementById("errorTable").style.display = "table"; // Vis tabel
                        updateHeader(); // Opdater headeren
                    }, 200);
                }, 200);
            }, 100);
        };
    </script>
</body>

</html>
